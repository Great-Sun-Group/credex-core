<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Application Deployment Workflow</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Application Deployment Workflow</h1>

      <p>
        This document provides an overview of the application deployment
        workflow, which is defined in <code>.github/workflows/app.yml</code>.
      </p>

      <h2>Workflow Overview</h2>

      <p>
        The "Deploy Application" workflow is designed to build, push, and deploy
        the application to AWS ECS (Elastic Container Service). It can be
        manually triggered and includes steps for managing Terraform state and
        infrastructure.
      </p>

      <p>Key aspects of this workflow include:</p>

      <ol>
        <li>
          <strong>Trigger</strong>: The workflow is manually triggered
          (<code>workflow_dispatch</code>).
        </li>
        <li>
          <strong>Environment</strong>: The workflow determines the environment
          (development, staging, or production) based on the Git branch.
        </li>
        <li>
          <strong>AWS Region</strong>: The workflow is configured to use the
          af-south-1 (Cape Town) region.
        </li>
        <li>
          <strong>Steps</strong>:
          <ul>
            <li>Checkout code</li>
            <li>Set environment variables</li>
            <li>Configure AWS credentials</li>
            <li>Setup and initialize Terraform</li>
            <li>Login to Amazon ECR</li>
            <li>Build, tag, and push Docker image to ECR</li>
            <li>Plan and apply Terraform changes</li>
            <li>Deploy the application to ECS</li>
            <li>Print deployment information</li>
          </ul>
        </li>
      </ol>

      <h2>Detailed Process</h2>

      <h3>1. Environment Setup</h3>
      <ul>
        <li>
          Sets the environment based on the Git branch (production, staging, or
          development)
        </li>
        <li>
          Initializes Terraform with environment-specific backend configuration
        </li>
      </ul>

      <h3>2. AWS Credential Configuration</h3>
      <ul>
        <li>Configures AWS credentials using GitHub secrets</li>
      </ul>

      <h3>3. Terraform Setup and Initialization</h3>
      <ul>
        <li>Sets up Terraform</li>
        <li>
          Initializes Terraform with the appropriate backend configuration,
          using environment-specific S3 buckets and DynamoDB tables for state
          management
        </li>
      </ul>

      <h3>4. Docker Image Build and Push</h3>
      <ul>
        <li>Logs in to Amazon ECR</li>
        <li>
          Builds the Docker image with environment-specific build arguments,
          including sensitive information from GitHub secrets
        </li>
        <li>Tags the image with the Git SHA</li>
        <li>Pushes the image to ECR</li>
      </ul>

      <h3>5. Terraform Plan and Apply</h3>
      <ul>
        <li>Plans Terraform changes, targeting the app module</li>
        <li>Applies Terraform changes, targeting the app module</li>
      </ul>

      <h3>6. Application Deployment</h3>
      <ul>
        <li>Fetches the current ECS task definition</li>
        <li>
          Updates the task definition with the new image and environment
          variables
        </li>
        <li>Registers the new task definition</li>
        <li>Updates the ECS service with the new task definition</li>
        <li>Waits for the service to stabilize</li>
      </ul>

      <h3>7. Deployment Information</h3>
      <ul>
        <li>Prints information about the completed deployment</li>
        <li>Outputs Terraform information for the app module</li>
      </ul>

      <h2>Important Notes</h2>

      <ol>
        <li>
          The workflow uses several GitHub secrets for sensitive information
          (e.g., AWS credentials, database credentials, API keys).
        </li>
        <li>
          The Docker build process includes multiple environment variables as
          build arguments, which are passed securely using GitHub secrets.
        </li>
        <li>
          The deployment process updates the ECS task definition and service,
          ensuring a smooth rollout of the new version.
        </li>
        <li>
          The workflow includes error handling and waiting mechanisms to ensure
          the deployment is successful.
        </li>
        <li>
          Terraform is used to manage the application infrastructure, with
          specific targeting of the app module.
        </li>
      </ol>

      <h2>Execution Caution</h2>

      <p>
        This workflow should be used with care as it deploys the application to
        a live environment, including production. Ensure that:
      </p>

      <ol>
        <li>The correct AWS credentials are configured.</li>
        <li>The appropriate environment (branch) is selected.</li>
        <li>
          All necessary secrets and environment variables are properly set in
          GitHub.
        </li>
        <li>The code being deployed has been thoroughly tested.</li>
        <li>
          You understand the implications of the Terraform changes being
          applied.
        </li>
      </ol>

      <h2>Post-Deployment Actions</h2>

      <p>After the deployment is complete:</p>

      <ol>
        <li>
          Review the Terraform outputs for any important information or changes.
        </li>
        <li>Verify the ECS service status and running tasks.</li>
        <li>Monitor application logs for any issues.</li>
        <li>Perform any necessary post-deployment tests or verifications.</li>
      </ol>

      <h2>Conclusion</h2>

      <p>
        The application deployment workflow provides an automated and controlled
        way to deploy the application to AWS ECS. It ensures that the latest
        code is built, containerized, and deployed with the appropriate
        configuration for each environment. The use of Terraform for
        infrastructure management adds an extra layer of consistency and control
        to the deployment process.
      </p>
    </div>
  </body>
</html>
